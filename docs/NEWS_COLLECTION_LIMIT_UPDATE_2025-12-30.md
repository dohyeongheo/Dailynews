# 뉴스 수집 개수 제한 수정

**수정 날짜**: 2025-12-30
**목적**: Fetch News Daily 워크플로우에서 뉴스 수집 개수를 카테고리별로 정확히 10개씩, 총 30개로 수정

## 🔍 문제 분석

### 현재 상황

- **현재 수집 개수**: 약 21개
- **원인**: 프롬프트에 "최소 20개 이상"이라고 명시되어 있어 Gemini가 약간 더 수집함

### 프롬프트 분석

**이전 프롬프트**:
```
최소 20개 이상
각 카테고리별로 가능한 한 많은 뉴스를 포함해주세요. (최소 10개 이상 권장)
```

**문제점**:
- "최소 20개 이상"이라는 모호한 지시
- 카테고리별 개수가 명확하지 않음
- Gemini가 21개 정도를 반환하는 것으로 추정

## ✅ 수정 사항

### 1. 프롬프트 수정 (`lib/news-fetcher.ts`)

**수정된 프롬프트**:
```
**중요: 각 카테고리별로 정확히 10개씩 수집해주세요. 총 30개의 뉴스를 수집해야 합니다.**
- "태국뉴스": 정확히 10개
- "관련뉴스": 정확히 10개
- "한국뉴스": 정확히 10개
```

**변경 사항**:
- ✅ "최소 20개 이상" → "정확히 10개씩, 총 30개"로 명확히 변경
- ✅ 각 카테고리별 개수를 명시적으로 지정
- ✅ 프롬프트 시작 부분에 강조 표시 추가

### 2. 코드 레벨 제한 추가 (`lib/news-fetcher.ts`)

**추가된 로직**:
```typescript
// 카테고리별로 정확히 10개씩 제한
const CATEGORY_LIMIT = 10;
const categoryCounts: Record<NewsCategory, number> = {
  태국뉴스: 0,
  관련뉴스: 0,
  한국뉴스: 0,
};

const limitedNewsItems: NewsInput[] = [];

// 카테고리별로 정렬하여 일관된 순서로 제한
for (const newsItem of translatedNewsItems) {
  const category = newsItem.category;
  if (categoryCounts[category] < CATEGORY_LIMIT) {
    limitedNewsItems.push(newsItem);
    categoryCounts[category]++;
  }
}
```

**목적**:
- Gemini가 정확히 10개씩 반환하지 않을 경우를 대비
- 코드 레벨에서 각 카테고리별로 정확히 10개씩 제한
- 일관된 순서로 제한하여 예측 가능한 결과 보장

## 📊 수정 전후 비교

### 수정 전

- 프롬프트: "최소 20개 이상"
- 실제 수집: 약 21개
- 카테고리별 개수: 불명확
- 코드 레벨 제한: 없음

### 수정 후

- 프롬프트: "정확히 10개씩, 총 30개"
- 예상 수집: 정확히 30개
- 카테고리별 개수: 각 10개씩 명시
- 코드 레벨 제한: 각 카테고리별 10개 제한

## 🎯 목표

- **태국 뉴스**: 정확히 10개
- **한국 뉴스**: 정확히 10개
- **관련 뉴스**: 정확히 10개
- **총합**: 정확히 30개

## 📝 수정된 파일

1. **`lib/news-fetcher.ts`**:
   - 프롬프트 수정 (524-567줄)
   - 카테고리별 제한 로직 추가 (838-860줄)

## 🧪 테스트 방법

1. **로컬 테스트**:
   ```bash
   npm run fetch-news
   ```

2. **GitHub Actions 테스트**:
   - Fetch News Daily 워크플로우 실행
   - 수집된 뉴스 개수 확인
   - 카테고리별 개수 확인

3. **확인 사항**:
   - 총 뉴스 개수: 30개
   - 태국 뉴스: 10개
   - 한국 뉴스: 10개
   - 관련 뉴스: 10개

## ✅ 완료 사항

- [x] 프롬프트 수정 (정확히 10개씩 명시)
- [x] 코드 레벨 제한 추가 (각 카테고리별 10개 제한)
- [x] 로깅 추가 (카테고리별 개수 확인)

## 📝 참고

- Gemini가 정확히 10개씩 반환하지 않을 경우, 코드 레벨에서 제한하여 보장
- 번역 처리 후에 제한을 적용하므로, 번역 실패한 뉴스는 제외됨
- 카테고리별로 순서대로 제한하므로, 일관된 결과를 보장

