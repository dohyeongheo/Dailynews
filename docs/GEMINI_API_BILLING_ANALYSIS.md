# Gemini API 사용 금액 및 과금 분석

**분석 일시**: 2025-12-31
**프로젝트**: gen-lang-client-0408997230
**Billing Account**: 01508D-982421-F9B27F

---

## 1. 현재까지 사용된 금액 (Google Cloud Console 기준)

### 12월 비용 요약

**Gemini API 비용**:
- 사용 비용: **₩39,758원**
- 절감 프로그램: **₩0원**
- 기타 절감: **-₩39,758원** (프로모션 크레딧)
- **총 비용: ₩0원**

**결과**: 현재까지 실제 청구 금액은 **₩0원**입니다. (프로모션 크레딧으로 전액 차감)

---

## 2. Gemini API 호출 패턴 분석

### API 호출 추이 (12월 기준)

**총 API 요청 수**:
- 12월 11일: 약 200-300건
- 12월 25일: 약 500건 (피크)
- 1월 1일: 약 200-300건

**API 오류 패턴**:
- **404 Not Found**: 초기 설정 단계에서 다수 발생 (약 300건)
- **429 TooManyRequests**: 12월 11일경 발생 (약 50-70건)
- **503 ServiceUnavailable**: 1월 1일경 소수 발생 (약 10-20건)

### 호출 유형별 분석

현재 시스템에서 Gemini API는 다음 3가지 작업에 사용됩니다:

1. **뉴스 수집** (`news_collection`)
   - 모델: `gemini-2.5-pro` (기본값)
   - 용도: 태국/한국 뉴스 수집 및 요약
   - 호출 빈도: 일 1회 (GitHub Actions 스케줄)

2. **번역** (`translation`)
   - 모델: `gemini-2.5-flash` (기본값)
   - 용도: 외국어 뉴스를 한국어로 번역
   - 호출 빈도: 뉴스 수집 시 자동 호출

3. **프롬프트 생성** (`prompt_generation`)
   - 모델: `gemini-2.5-flash`
   - 용도: 이미지 생성용 프롬프트 생성
   - 호출 빈도: 뉴스당 1회

---

## 3. 과금 구조 및 발생 방식

### Gemini API 과금 모델

#### 토큰 기반 과금

**Gemini 2.5 Pro**:
- 입력 토큰: $0.125 per 1M tokens (약 1,000원/1M 토큰, 환율 8,000원 기준)
- 출력 토큰: $0.5 per 1M tokens (약 4,000원/1M 토큰)

**Gemini 2.5 Flash**:
- 입력 토큰: $0.075 per 1M tokens (약 600원/1M 토큰)
- 출력 토큰: $0.3 per 1M tokens (약 2,400원/1M 토큰)

### 비용 발생 시나리오

#### 시나리오 1: 일일 뉴스 수집 (30개 뉴스 기준)

1. **뉴스 수집** (Pro 모델)
   - 입력: 약 2,000 토큰 (프롬프트)
   - 출력: 약 15,000 토큰 (30개 뉴스 JSON)
   - 비용: (2,000/1M × 1,000원) + (15,000/1M × 4,000원) = **약 62원**

2. **번역** (Flash 모델, 평균 20개 번역 필요)
   - 입력: 평균 500 토큰/뉴스 × 20 = 10,000 토큰
   - 출력: 평균 400 토큰/뉴스 × 20 = 8,000 토큰
   - 비용: (10,000/1M × 600원) + (8,000/1M × 2,400원) = **약 25원**

3. **프롬프트 생성** (Flash 모델, 30개)
   - 입력: 평균 300 토큰/뉴스 × 30 = 9,000 토큰
   - 출력: 평균 200 토큰/뉴스 × 30 = 6,000 토큰
   - 비용: (9,000/1M × 600원) + (6,000/1M × 2,400원) = **약 19원**

**일일 총 예상 비용**: 약 **106원**

#### 시나리오 2: 월간 예상 비용

- 일일 비용: 약 106원
- 월간 (30일): 약 **3,180원**
- 현재 사용량 (₩39,758): 약 **375일치** 사용량에 해당

**분석**: 실제 사용량이 예상보다 높은 이유:
1. 초기 테스트 및 개발 단계에서 다수 호출
2. 에러 재시도로 인한 추가 호출
3. Context Caching 미활성화 또는 비효율적 사용

---

## 4. 과금 최적화 전략

### 현재 적용 중인 최적화

1. **모델 선택 최적화**
   - 뉴스 수집: Pro 모델 (복잡한 작업)
   - 번역/프롬프트: Flash 모델 (단순 작업)
   - **절감 효과**: 약 60-70% 비용 절감

2. **Context Caching**
   - 동일한 프롬프트 재사용 시 비용 절감
   - 현재 활성화됨 (`GEMINI_USE_CONTEXT_CACHING=true`)

3. **에러 처리**
   - 재시도 로직으로 불필요한 호출 최소화
   - 할당량 초과 시 자동 중단

### 추가 최적화 방안

1. **배치 처리**
   - 여러 뉴스를 한 번에 처리하여 API 호출 횟수 감소
   - **예상 절감**: 10-15%

2. **캐시 활용 강화**
   - 번역 결과 캐싱으로 중복 번역 방지
   - **예상 절감**: 20-30%

3. **모델 전환 검토**
   - 뉴스 수집도 Flash 모델로 전환 검토 (품질 확인 후)
   - **예상 절감**: 50-60%

---

## 5. 현재 시스템의 사용량 추적 상태

### 데이터베이스 상태

**gemini_usage_logs 테이블**:
- 현재 로그 수: **0건**
- 상태: 마이그레이션 완료, 추적 시스템 준비 완료

**이유**:
- 마이그레이션이 방금 완료됨
- 아직 새로운 API 호출이 발생하지 않음
- 다음 뉴스 수집부터 자동 추적 시작

### 향후 추적 예정 정보

다음 뉴스 수집부터 다음 정보가 자동으로 기록됩니다:

1. **호출별 상세 정보**
   - 모델 이름
   - 작업 유형
   - 입력/출력 토큰 수
   - 추정 비용
   - 응답 시간
   - 성공/실패 여부

2. **일별 집계**
   - 일별 총 비용
   - 일별 총 토큰 수
   - 일별 호출 횟수
   - 성공률

3. **모델별/작업별 분석**
   - 모델별 비용 분포
   - 작업 유형별 비용 분포
   - 호출당 평균 비용

---

## 6. Google Cloud Console에서 확인하는 방법

### 비용 확인

1. **Google Cloud Console 접속**
   - https://console.cloud.google.com/billing

2. **프로젝트 선택**
   - 프로젝트: `gen-lang-client-0408997230`

3. **비용 상세 확인**
   - "사용량 및 결제" → "결제" 탭
   - 서비스별 필터: "Gemini API"
   - 기간 선택: 원하는 기간

### 사용량 확인

1. **Google AI Studio 접속**
   - https://aistudio.google.com/

2. **사용량 대시보드**
   - "사용량 및 결제" → "사용량" 탭
   - API 요청 수, 에러 수 확인
   - 모델별 사용량 확인

---

## 7. 관리자 대시보드에서 확인하는 방법

### 비용 모니터링 대시보드

1. **접속**: `/admin` → "비용 모니터링" 탭

2. **확인 가능한 정보**:
   - 실시간 비용 표시
   - 일별/주별/월별 비용 추이
   - 모델별 사용량 비교
   - 작업 유형별 비용 분석
   - 비용 절감 제안

3. **API 엔드포인트**:
   ```
   GET /api/admin/cost?period=monthly
   ```

---

## 8. 결론 및 권장 사항

### 현재 상황

- ✅ **Billing Account 연결**: 정상
- ✅ **사용량 추적 시스템**: 구축 완료
- ⚠️ **실제 사용량 로그**: 아직 없음 (다음 호출부터 시작)
- ✅ **프로모션 크레딧**: ₩39,758원 사용, 총 비용 ₩0원

### 권장 사항

1. **정기 모니터링**
   - 주 1회 관리자 대시보드에서 비용 확인
   - 예산 사용률 80% 이상 시 알림 확인

2. **비용 최적화**
   - 모델별 사용량 분석 후 필요시 Flash 모델로 전환 검토
   - 에러율 모니터링 및 개선

3. **예산 관리**
   - 월별 예산: 40,000원
   - 일별 알림 임계값: 30,000원
   - 예산 초과 시 자동 알림

---

**작성자**: AI Agent
**최종 업데이트**: 2025-12-31


